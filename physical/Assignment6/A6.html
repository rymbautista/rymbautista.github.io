<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./A6.css" />
    <title>A6 Talking to the Web! üíª</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>üê∏</text></svg>">
  </head>
  <body>
    <h1 class="fade-in-text">A6 Talking to the Web! üíª</h1>
    <div class="writeup-container">
      <div>
        <p class="intro-paragraph">
          <h2>Overview</h2>
          <b> 
            A6 Talking to the Web! was to utalize Java script so that we can have the arduino create inputs for the computer and vise versa where
            we can make input from the computer to the arduino.
        <div><img class="picture"
            src="/physical/images/A6pic.jpg" /> 
        <span class="caption">Image of the "A6 Talking to the Web!" circuit</span> 
        <img class="picture"
        src="/physical/images/A6gif.gif" />
        <span class="caption">Gif of a circuit that takes input from a joystick to move around a circle on the computer. Then from the computer when the space bar is pressed
          the red LED is turned on.
        </span>  
        </div>      
          <br>
          <h2>üë®‚ÄçüíªFirmware</h2> 
          <h3>Arduino</h3> 
          <pre> <code>
            void setup() {
              // put your setup code here, to run once:
              Serial.begin(9600);
              Serial.setTimeout(10); // set the timeout for parseInt
             pinMode(5, OUTPUT);
            }
            
            void loop() {
              // put your main code here, to run repeatedly:
              int s1 = analogRead(A0);
              int s2 = analogRead(A1);
              Serial.print("[");
              Serial.print(s1);
              Serial.print(",");
              Serial.print(s2);
              Serial.println("]");
              delay(50);
              if (Serial.available() > 0) {   // if there's serial data 
                int inByte = Serial.read(); // read it
                Serial.write(inByte);  	// send it back out as raw binary data
                if (inByte == 32) {     // detects if the space bar was pressed
                  analogWrite(5, 150);  // Sets the led to a light level of 150
                } else if (inByte == 48) {  //detectes if the '0' key was pressed 
                  analogWrite(5, 0);      //Set the light level to 0
                } else {                // Detects if any key is pressed
                  analogWrite(5, 50);	// sets the light level to 50
                }
              }
            }
        
        Some code was adapted from the <a href="https://docs.google.com/presentation/d/1aAMFgXm5N2HypPeqKlxVltI8ZedkZ-D7iix1DFV73z0/edit#slide=id.g4fcc6364fc_0_294">Capacitive touch example</a>(*) indicated by asterisk in the comments 

          </code> </pre> 
          <h3>Javascript</h3> 
          <pre> <code>
            var serial; // variable to hold an instance of the serialport library
            var portName = 'COM3'; //rename to the name of your port
            var dataarray = []; //some data coming in over serial!


            function setup() {
              serial = new p5.SerialPort();       // make a new instance of the serialport library
              serial.on('list', printList);       // set a callback function for the serialport list event
              serial.on('connected', serverConnected); // callback for connecting to the server
              serial.on('open', portOpen);        // callback for the port opening
              serial.on('data', serialEvent);     // callback for when new data arrives
              serial.on('error', serialError);    // callback for errors
              serial.on('close', portClose);      // callback for the port closing
            
              serial.list();                      // list the serial ports
              serial.open(portName);              // open a serial port
              createCanvas(windowWidth, windowHeight);
              background(0x08, 0x16, 0x40);
            }
            
            // get the list of ports:
            function printList(portList) {
            // portList is an array of serial port names
            for (var i = 0; i < portList.length; i++) {
            // Display the list the console:
              print(i + " " + portList[i]);
            }
            }

            function serverConnected() {
              print('connected to server.');
            }
            
            function portOpen() {
              print('the serial port opened.')
            }
            
            function serialError(err) {
              print('Something went wrong with the serial port. ' + err);
            }
            
            function portClose() {
              print('The serial port closed.');
            }

            function serialEvent() {
              if (serial.available()) {
                var datastring = serial.readLine(); // readin some serial
                var newarray; 
                try {
                  newarray = JSON.parse(datastring); // can we parse the serial
                  if (typeof newarray == 'object') {
                    dataarray = newarray;
                  }
                  console.log("got back " + datastring);
                  } catch(err) {
                  // got something that's not a json
                }
              } 
            }

            function draw() {
              clear();
              map(dataarray[0],0,1022,0,windowHeight);
              map(dataarray[1],0,1022,0,windowWidth);
              constrain(dataarray[0],0,windowHeight);
              constrain(dataarray[1],0,windowWidth);
              circle(dataarray[0],dataarray[1], 40);
            }

            function keyPressed() {
              console.log("writing key");
              serial.write(key);
            }
        
        Some code was adapted from the <a href="https://docs.google.com/presentation/d/1aAMFgXm5N2HypPeqKlxVltI8ZedkZ-D7iix1DFV73z0/edit#slide=id.g4fcc6364fc_0_294">Capacitive touch example</a>(*) indicated by asterisk in the comments 
            </code> </pre> 
            <span class="caption">Code that utilizes capacitive touch to turn on an LED strip with the use of a transistor. 
              It sets the use of pin 2 as a sensor pin for capacitive touch and then Pin 6 as an output and starts the serial 
              monitor. Then it starts a timer to track time for debugging, then tota1 is used to store the reading from the 
              capacitive touch then we constrain the readings and then map them from 0 to 255 for an appropriate range for 
              analogWrite(). for debugging the totals are printed and then written to pin 6 for the transistor to limit the 
              power that goes through the transistor and power the LED strip.
            </span>
          <br> 
          <h2>üßÆ Calculations and Schematic üìÑ</h2>
          For calculations for the LEDs, I utilized Ohm's law (V=IR) to calculate the minimum amount of resistance to use. The computer outputs 5V (V=5)
           and a red LED causes a drop of 1.8V. Then from the Datasheet document, the max amount of current for the LEDs should be .03MA so I used .02A 
           to be safe. Now that I have the variables for solving for the resistance needed I solved it and found that R = 160Œ© for red blue was R = 85Œ©. 
           In my circuit, I decided to use 330Œ© as it was higher than the minimum about of resistance needed to power the circuit. Then for what I used for
           analog write was light levels based off of what key were detected, so with the ascii for space (32) is set the led to a light level of 150, and
           I had it read for 0 (ascii 48) and set the light level to 0. Finally had it set the light level to 50 for any other key that was read.
          <br>
              <img class="picture"
              src="/physical/images/A6cal.png" /> 
              <span class="caption">Calculation using Ohm's Law to find Resistance for the red LED.
              </span> 
              <img class="picture"
              src="/physical/images/A6cir.png" /> 
              <span class="caption">Schematic of the Talking to the Web! Circuit</span> 
              <a href="/physical\physical.html">
              <span class="caption">Home üè†</span>  
              </a>        
              <br> 
          </b>
        </p>
      </div>
    </div>
  </body>
</html>
